'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var https = require('https');
var http = require('http');

var HttpClient = function () {
  function HttpClient(options) {
    _classCallCheck(this, HttpClient);

    this.port = 443 || options.port;
    this.https = options.https || https;
    this.http = options.http || http;
    this.headers = {
      'Content-Type': 'application/x-www-form-urlencoded',
      'Accept': 'application/json'
    };
    this.logger = options.logger;

    if (options.userAgent) {
      this.headers['User-Agent'] = options.userAgent;
    }
  }

  _createClass(HttpClient, [{
    key: 'request',
    value: function request(endpoint, method, callback) {
      var _this = this;

      if (typeof method == 'function') {
        callback = method;
        endpoint.method = endpoint.method || 'GET';
      } else if (typeof method !== 'undefined') {
        endpoint.method = method;
      }

      if (endpoint.method == 'POST' || endpoint.method == 'DELETE') {
        // TODO: verify the following fix is required
        // Fix broken due ot 411 Content-Length error now sent by Nexmo API
        // PL 2016-Sept-6 - commented out Content-Length 0
        // headers['Content-Length'] = 0;
      }
      var options = {
        host: endpoint.host ? endpoint.host : 'rest.nexmo.com',
        port: this.port,
        path: endpoint.path,
        method: endpoint.method,
        headers: this.headers
      };

      // Allow existing headers to be overridden
      // Allow new headers to be added
      if (endpoint.headers) {
        Object.keys(endpoint.headers).forEach(function (key) {
          options.headers[key] = endpoint.headers[key];
        });
      }

      this.logger.info('Request:', options, '\nBody:', endpoint.body);
      var request;

      if (options.port == 443) {
        request = this.https.request(options);
      } else {
        request = http.request(options);
      }

      request.end(endpoint.body);

      // Keep an array of String or Buffers,
      // depending on content type (binary or JSON) of response
      var responseData = [];

      request.on('response', function (response) {
        var isBinary = response.headers['content-type'] === 'application/octet-stream';
        if (!isBinary) {
          response.setEncoding('utf8');
        }

        response.on('data', function (chunk) {
          responseData.push(chunk);
        });

        response.on('end', function () {
          _this.logger.info('response ended:', response.statusCode);
          if (callback) {
            if (isBinary) {
              responseData = Buffer.concat(responseData);
            }

            _this.__parseReponse(response.status, response.headers['content-type'], responseData, method, callback);
          }
        });
        response.on('close', function (e) {
          _this.logger.error('problem with API request detailed stacktrace below ');
          _this.logger.error(e);
          callback(e);
        });
      });
      request.on('error', function (e) {
        _this.logger.error('problem with API request detailed stacktrace below ');
        _this.logger.error(e);
        callback(e);
      });
    }
  }, {
    key: '__parseReponse',
    value: function __parseReponse(status, contentType, data, method, callback) {
      var response = null;
      var error = null;

      try {
        if (status >= 500) {
          error = { message: 'Server Error: ' + status };
        } else if (status >= 400 || status < 200) {
          error = JSON.parse(data);
        } else if (contentType === 'application/octet-stream') {
          response = data;
        } else if (method !== 'DELETE') {
          response = JSON.parse(data);
        } else {
          response = data;
        }
      } catch (parseError) {
        this.logger.error(parseError);
        this.logger.error('could not convert API response to JSON, above error is ignored and raw API response is returned to client');
        this.logger.error('Raw Error message from API ');
        this.logger.error(data);

        error = {
          message: "The API response could not be parsed.",
          parseError: parseError
        };
      }

      callback(error, response);
    }
  }]);

  return HttpClient;
}();

exports.default = HttpClient;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;base64,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QVosQ0FBa0IsVUFBbEI7QUFDQSxhQUFLLE1BQUwsQ0FBWSxLQUFaLENBQWtCLDJHQUFsQjtBQUNBLGFBQUssTUFBTCxDQUFZLEtBQVosQ0FBa0IsNkJBQWxCO0FBQ0EsYUFBSyxNQUFMLENBQVksS0FBWixDQUFrQixJQUFsQjs7QUFFQSxnQkFBUTtBQUNOLG1CQUFTLHVDQURIO0FBRU4sc0JBQVk7QUFGTixTQUFSO0FBSUQ7O0FBRUQsZUFBUyxLQUFULEVBQWdCLFFBQWhCO0FBQ0Q7Ozs7OztrQkFHWSxVIiwiZmlsZSI6Ikh0dHBDbGllbnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgaHR0cHMgPSByZXF1aXJlKCdodHRwcycpO1xudmFyIGh0dHAgPSByZXF1aXJlKCdodHRwJyk7XG5cbmNsYXNzIEh0dHBDbGllbnQge1xuICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7XG4gICAgdGhpcy5wb3J0ID0gNDQzIHx8IG9wdGlvbnMucG9ydDtcbiAgICB0aGlzLmh0dHBzID0gb3B0aW9ucy5odHRwcyB8fCBodHRwcztcbiAgICB0aGlzLmh0dHAgPSAgb3B0aW9ucy5odHRwIHx8IGh0dHA7XG4gICAgdGhpcy5oZWFkZXJzID0ge1xuICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcsXG4gICAgICAgICdBY2NlcHQnOiAnYXBwbGljYXRpb24vanNvbidcbiAgICB9O1xuICAgIHRoaXMubG9nZ2VyID0gb3B0aW9ucy5sb2dnZXI7XG5cbiAgICBpZihvcHRpb25zLnVzZXJBZ2VudCkge1xuICAgICAgdGhpcy5oZWFkZXJzWydVc2VyLUFnZW50J10gPSBvcHRpb25zLnVzZXJBZ2VudDtcbiAgICB9XG4gIH1cblxuICByZXF1ZXN0KGVuZHBvaW50LCBtZXRob2QsIGNhbGxiYWNrKSB7XG4gICAgaWYgKHR5cGVvZiBtZXRob2QgPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICBjYWxsYmFjayA9IG1ldGhvZDtcbiAgICAgICAgZW5kcG9pbnQubWV0aG9kID0gZW5kcG9pbnQubWV0aG9kIHx8ICdHRVQnO1xuICAgIH1cbiAgICBlbHNlIGlmICh0eXBlb2YgbWV0aG9kICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgXHRlbmRwb2ludC5tZXRob2QgPSBtZXRob2Q7XG4gICAgfVxuXG4gICAgaWYgKGVuZHBvaW50Lm1ldGhvZCA9PSAnUE9TVCcgfHwgZW5kcG9pbnQubWV0aG9kID09ICdERUxFVEUnKSB7XG4gICAgICAgIC8vIFRPRE86IHZlcmlmeSB0aGUgZm9sbG93aW5nIGZpeCBpcyByZXF1aXJlZFxuICAgICAgICAvLyBGaXggYnJva2VuIGR1ZSBvdCA0MTEgQ29udGVudC1MZW5ndGggZXJyb3Igbm93IHNlbnQgYnkgTmV4bW8gQVBJXG4gICAgICAgIC8vIFBMIDIwMTYtU2VwdC02IC0gY29tbWVudGVkIG91dCBDb250ZW50LUxlbmd0aCAwXG4gICAgICAgIC8vIGhlYWRlcnNbJ0NvbnRlbnQtTGVuZ3RoJ10gPSAwO1xuICAgIH1cbiAgICB2YXIgb3B0aW9ucyA9IHtcbiAgICAgICAgaG9zdDogZW5kcG9pbnQuaG9zdD9lbmRwb2ludC5ob3N0OidyZXN0Lm5leG1vLmNvbScsXG4gICAgICAgIHBvcnQ6IHRoaXMucG9ydCxcbiAgICAgICAgcGF0aDogZW5kcG9pbnQucGF0aCxcbiAgICAgICAgbWV0aG9kOiBlbmRwb2ludC5tZXRob2QsXG4gICAgICAgIGhlYWRlcnM6IHRoaXMuaGVhZGVyc1xuICAgIH07XG5cbiAgICAvLyBBbGxvdyBleGlzdGluZyBoZWFkZXJzIHRvIGJlIG92ZXJyaWRkZW5cbiAgICAvLyBBbGxvdyBuZXcgaGVhZGVycyB0byBiZSBhZGRlZFxuICAgIGlmKGVuZHBvaW50LmhlYWRlcnMpIHtcbiAgICAgIE9iamVjdC5rZXlzKGVuZHBvaW50LmhlYWRlcnMpLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7XG4gICAgICAgIG9wdGlvbnMuaGVhZGVyc1trZXldID0gZW5kcG9pbnQuaGVhZGVyc1trZXldO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgdGhpcy5sb2dnZXIuaW5mbygnUmVxdWVzdDonLCBvcHRpb25zLCAnXFxuQm9keTonLCBlbmRwb2ludC5ib2R5KTtcbiAgICB2YXIgcmVxdWVzdDtcblxuICAgIGlmIChvcHRpb25zLnBvcnQgPT0gNDQzKSB7XG4gICAgICAgIHJlcXVlc3QgPSB0aGlzLmh0dHBzLnJlcXVlc3Qob3B0aW9ucyk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmVxdWVzdCA9IGh0dHAucmVxdWVzdChvcHRpb25zKTtcbiAgICB9XG5cbiAgICByZXF1ZXN0LmVuZChlbmRwb2ludC5ib2R5KTtcblxuICAgIC8vIEtlZXAgYW4gYXJyYXkgb2YgU3RyaW5nIG9yIEJ1ZmZlcnMsXG4gICAgLy8gZGVwZW5kaW5nIG9uIGNvbnRlbnQgdHlwZSAoYmluYXJ5IG9yIEpTT04pIG9mIHJlc3BvbnNlXG4gICAgdmFyIHJlc3BvbnNlRGF0YSA9IFtdO1xuXG4gICAgcmVxdWVzdC5vbigncmVzcG9uc2UnLCAocmVzcG9uc2UpID0+IHtcbiAgICAgICAgdmFyIGlzQmluYXJ5ID0gcmVzcG9uc2UuaGVhZGVyc1snY29udGVudC10eXBlJ10gPT09ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nO1xuICAgICAgICBpZiAoIWlzQmluYXJ5KSB7IHJlc3BvbnNlLnNldEVuY29kaW5nKCd1dGY4Jyk7IH1cblxuICAgICAgICByZXNwb25zZS5vbignZGF0YScsIChjaHVuaykgPT4ge1xuICAgICAgICAgIHJlc3BvbnNlRGF0YS5wdXNoKGNodW5rKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmVzcG9uc2Uub24oJ2VuZCcsICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyLmluZm8oJ3Jlc3BvbnNlIGVuZGVkOicsIHJlc3BvbnNlLnN0YXR1c0NvZGUpO1xuICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgIGlmIChpc0JpbmFyeSkgeyByZXNwb25zZURhdGEgPSBCdWZmZXIuY29uY2F0KHJlc3BvbnNlRGF0YSk7IH1cblxuICAgICAgICAgICAgICB0aGlzLl9fcGFyc2VSZXBvbnNlKFxuICAgICAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1cyxcbiAgICAgICAgICAgICAgICByZXNwb25zZS5oZWFkZXJzWydjb250ZW50LXR5cGUnXSxcbiAgICAgICAgICAgICAgICByZXNwb25zZURhdGEsXG4gICAgICAgICAgICAgICAgbWV0aG9kLFxuICAgICAgICAgICAgICAgIGNhbGxiYWNrXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIHJlc3BvbnNlLm9uKCdjbG9zZScsIChlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmxvZ2dlci5lcnJvcigncHJvYmxlbSB3aXRoIEFQSSByZXF1ZXN0IGRldGFpbGVkIHN0YWNrdHJhY2UgYmVsb3cgJyk7XG4gICAgICAgICAgICB0aGlzLmxvZ2dlci5lcnJvcihlKTtcbiAgICAgICAgICAgIGNhbGxiYWNrKGUpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbiAgICByZXF1ZXN0Lm9uKCdlcnJvcicsIChlKSA9PiB7XG4gICAgICAgIHRoaXMubG9nZ2VyLmVycm9yKCdwcm9ibGVtIHdpdGggQVBJIHJlcXVlc3QgZGV0YWlsZWQgc3RhY2t0cmFjZSBiZWxvdyAnKTtcbiAgICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoZSk7XG4gICAgICAgIGNhbGxiYWNrKGUpO1xuICAgIH0pO1xuXG4gIH1cblxuICBfX3BhcnNlUmVwb25zZShzdGF0dXMsIGNvbnRlbnRUeXBlLCBkYXRhLCBtZXRob2QsIGNhbGxiYWNrKSB7XG4gICAgdmFyIHJlc3BvbnNlID0gbnVsbDtcbiAgICB2YXIgZXJyb3IgPSBudWxsO1xuXG4gICAgdHJ5IHtcbiAgICAgIGlmIChzdGF0dXMgPj0gNTAwKSB7XG4gICAgICAgIGVycm9yID0geyBtZXNzYWdlOiAnU2VydmVyIEVycm9yOiAnK3N0YXR1cyB9O1xuICAgICAgfSBlbHNlIGlmIChzdGF0dXMgPj0gNDAwIHx8IHN0YXR1cyA8IDIwMCkge1xuICAgICAgICBlcnJvciA9IEpTT04ucGFyc2UoZGF0YSk7XG4gICAgICB9IGVsc2UgaWYgKGNvbnRlbnRUeXBlID09PSAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJykge1xuICAgICAgICByZXNwb25zZSA9IGRhdGE7XG4gICAgICB9IGVsc2UgaWYgKG1ldGhvZCAhPT0gJ0RFTEVURScpIHtcbiAgICAgICAgcmVzcG9uc2UgPSBKU09OLnBhcnNlKGRhdGEpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzcG9uc2UgPSBkYXRhO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKHBhcnNlRXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKHBhcnNlRXJyb3IpO1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoJ2NvdWxkIG5vdCBjb252ZXJ0IEFQSSByZXNwb25zZSB0byBKU09OLCBhYm92ZSBlcnJvciBpcyBpZ25vcmVkIGFuZCByYXcgQVBJIHJlc3BvbnNlIGlzIHJldHVybmVkIHRvIGNsaWVudCcpO1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoJ1JhdyBFcnJvciBtZXNzYWdlIGZyb20gQVBJICcpO1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoZGF0YSk7XG5cbiAgICAgIGVycm9yID0ge1xuICAgICAgICBtZXNzYWdlOiBcIlRoZSBBUEkgcmVzcG9uc2UgY291bGQgbm90IGJlIHBhcnNlZC5cIixcbiAgICAgICAgcGFyc2VFcnJvcjogcGFyc2VFcnJvclxuICAgICAgfTtcbiAgICB9XG5cbiAgICBjYWxsYmFjayhlcnJvciwgcmVzcG9uc2UpO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEh0dHBDbGllbnQ7XG4iXX0=